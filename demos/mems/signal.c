/*
 * Signal.c - generate various signals
 *
 * To understand FFTs you need to understand DFTs and
 * this code applies the DFT using correlation to the
 * samples generated by data gen.
 *
 */

#include <stdio.h>
#include <stdlib.h>
#include <stdint.h>
#include <string.h>
#include <math.h>
#include "signal.h"

/*
 * basis function
 *
 * This is a basis function (cos)
 *	f is the frequency
 *	t is the time.
 */
float
cos_basis(float f, float t)
{
	return cos(2 * M_PI * f * t);
}

/*
 * This is the sin basis function
 */
float
sin_basis(float f, float t)
{
	return sin(2 * M_PI * f * t);
}

/*
 * add_cos( ... )
 *
 * Add in a signal at this frequency and amplitude into
 * the sample buffer. 
 */
void
add_cos(sample_buffer *s, float f, float a)
{
	int	i;
	float *buf = s->data;

	/*
	 * n is samples
	 * r is rate (samples per second)
	 * f is frequency (cycles per second)
	 * what span is (n / r) seconds / f = cyles /n is cycles per sample?
	 */
	for (i = 0; i < s->n; i++ ) {
		*buf += a * cos(2 * M_PI * f * i / s->r);
		buf++;
	}
}


/*
 * add_triangle( ... )
 *
 * Add a triangle wave to the sample buffer.
 *
 * seconds per sample * sample # = time
 * period is seconds per period.
 * seconds / period - int seconds = percentage of period.
 */
void
add_triangle(sample_buffer *s, float f, float a)
{
	int i;
	float period = (float) s->r / f;
	float t;
	float *buf = s->data;

	for (i = 0; i < s->n; i++) {
		t = (float) i / period;
		t = t - (int) t;
		*buf += a * t;
		buf++;
	}
}

void
add_square(sample_buffer *s, float f, float a)
{
	int i;
	int per = s->r / (2 * f);
	float *buf = s->data;

	printf("Square wave period is %d\n", per);
	for (i = 0; i < s->n; i++) {
		*buf += ((i / per) & 1) * a;
		buf++;
	}
}
